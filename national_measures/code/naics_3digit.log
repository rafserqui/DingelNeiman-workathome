
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 8-core Stata perpetual license:
       Serial number:  10699393
         Licensed to:  Rafael
                       

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do "naics_3digit.do" 

. clear all

. foreach package in listtex {
  2.     capture which `package'
  3.     if _rc==111 ssc install `package'
  4. }

. 
. 
. //BN-JD coding of teleworkability
. //LOAD NAICS-SOC data
. import excel using "../input/nat3d_M2018_dl.xlsx", clear firstrow

. keep if OCC_GROUP=="broad"
(25,281 observations deleted)

. //Merge with BN-JD coding of teleworkability
. clonevar BroadGroupCode = OCC_CODE

. merge m:1 BroadGroupCode using "../input/Teleworkable_BNJDopinion.dta", asser
> t(using match) keep(match) nogen

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            14,099  
    -----------------------------------------

. rename Teleworkable teleworkable

. //Generate employment-weighted and wage-weighted means
. destring TOT_EMP, replace ig(*)
TOT_EMP: character * removed; replaced as long
(940 missing values generated)

. bys NAICS: egen emp_denom  = total(TOT_EMP)

. bys NAICS: egen emp_numer  = total(teleworkable*TOT_EMP)

. replace H_MEAN = "100" if H_MEAN=="#"
(0 real changes made)

. destring H_MEAN, replace ig(*)
H_MEAN: character * removed; replaced as double
(399 missing values generated)

. bys NAICS: egen wage_denom = total(H_MEAN*TOT_EMP*(missing(H_MEAN)==0))

. bys NAICS: egen wage_numer = total(teleworkable*H_MEAN*TOT_EMP*(missing(H_MEA
> N)==0))

. gen teleworkable_emp = emp_numer / emp_denom

. gen teleworkable_wage = wage_numer / wage_denom

. //Industry-level results
. keep NAICS NAICS_TITLE teleworkable_emp teleworkable_wage

. duplicates drop

Duplicates in terms of all variables

(14,011 observations deleted)

. //Report results in CSV 
. tempfile tf_forcsv_manual

. save `tf_forcsv_manual'
file C:\Users\Rafael\AppData\Local\Temp\ST_00000001.tmp saved

. 
. //O*NET-derived measure
. 
. //LOAD NAICS-SOC data
. import excel using "../input/nat3d_M2018_dl.xlsx", clear firstrow

. keep if OCC_GROUP=="detailed"
(20,819 observations deleted)

. //Merge with ONET-based coding of teleworkability; fill in "miscellaneous" ca
> tegories using 4-digit means
. merge m:1 OCC_CODE using "../input/onet_teleworkable_blscodes.dta", keep(mast
> er match)

    Result                           # of obs.
    -----------------------------------------
    not matched                           924
        from master                       924  (_merge==1)
        from using                          0  (_merge==2)

    matched                            17,637  (_merge==3)
    -----------------------------------------

. destring TOT_EMP, replace ig(*)
TOT_EMP: character * removed; replaced as long
(1266 missing values generated)

. gen str OCC_CODE_4digit = substr(OCC_CODE,1,5)

. bys OCC_CODE_4digit: egen numer = total(telew*TOT_EMP)

. bys OCC_CODE_4digit: egen denom = total(TOT_EMP)

. gen telew_4digit = numer / denom

. replace teleworkable = telew_4digit if missing(teleworkable)==1 & (substr(OCC
> _CODE,-1,1)=="9"|substr(OCC_CODE,-2,2)=="90"|OCC_CODE=="11-1031") & (strpos(O
> CC_TITLE,"All Other")!=0|strpos(OCC_TITLE,"Miscellaneous")!=0|OCC_TITLE=="Leg
> islators") //
(924 real changes made)

. assert missing(teleworkable)==0

. drop _merge OCC_CODE_4digit  numer denom telew_4digit

. //Generate employment-weighted and wage-weighted means
. bys NAICS: egen emp_denom  = total(TOT_EMP)

. bys NAICS: egen emp_numer  = total(teleworkable*TOT_EMP)

. replace H_MEAN = "100" if H_MEAN=="#"
(1 real change made)

. destring H_MEAN, replace ig(*)
H_MEAN: character * removed; replaced as double
(573 missing values generated)

. bys NAICS: egen wage_denom = total(H_MEAN*TOT_EMP*(missing(H_MEAN)==0))

. bys NAICS: egen wage_numer = total(teleworkable*H_MEAN*TOT_EMP*(missing(H_MEA
> N)==0))

. gen teleworkable_emp = emp_numer / emp_denom

. gen teleworkable_wage = wage_numer / wage_denom

. //Industry-level results
. keep NAICS NAICS_TITLE teleworkable_emp teleworkable_wage

. duplicates drop

Duplicates in terms of all variables

(18,473 observations deleted)

. //Report results in CSV 
. tempfile tf_forcsv_baseline

. save `tf_forcsv_baseline'
file C:\Users\Rafael\AppData\Local\Temp\ST_00000002.tmp saved

. 
. 
. //Export both measures to CSV
. use `tf_forcsv_manual', clear

. rename (teleworkable_emp teleworkable_wage) (teleworkable_manual_emp telework
> able_manual_wage)

. merge 1:1 NAICS using `tf_forcsv_baseline', assert(match) nogen

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                88  
    -----------------------------------------

. assert substr(NAICS,4,3)=="000" & length(NAICS)==6

. replace NAICS = substr(NAICS,1,3)
(88 real changes made)

. order NAICS NAICS_TITLE teleworkable_emp teleworkable_wage teleworkable_manua
> l_emp teleworkable_manual_wage

. export delimited using "../output/NAICS3_workfromhome.csv", replace
file ../output/NAICS3_workfromhome.csv saved

. 
. 
end of do-file
